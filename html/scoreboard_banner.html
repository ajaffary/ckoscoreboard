<!--
    Websockets code generated by ChatGPT:
    https://chatgpt.com/share/6771d56d-ed1c-8000-99e0-4a91db08f053

    this should eventually be the CKO Scoreboard banner
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="scoreboard_banner.css">
    <title id="scoreboard-banner">Scoreboard Banner</title>
</head>
<body>
    <div class="timer-container">
        <div id="home-team-score" class="tile score-tile home-score-tile">
            00
        </div>
        <div class="tile home-logo-tile prp">
            Punk Rock Punishers
            <!-- <img src="../../cko 2023/assets/team logos/Punk-Rock Punishers [Color] [Worn] [CKORD Cropped] [470px].png"
                alt="Punk Rock Punishers" height="100px">
            -->
        </div>
        <div id="game-segment" class="tile period-tile">
            Period 1
            <!-- <br/> &nbsp;&nbsp;Time: 30:00 -->
        </div>
        <div class="tile info-tile">
            Time<br/>
            Out
        </div>
        <div class="tile cko-tile">
            <img src="../images/ckostamp4x6-black-bg.png" 
                alt="Chicago Knockouts Roller Derby" height="100%">
        </div>
        <div class="tile jam-number-tile">
            <span id="jam">JAM</span><br/><span id="jam-number">X</span>
        </div>
        <div class="tile jam-timer-tile">
            <span id="jam-timer">1:00</span>
        </div>
        <div class="tile away-logo-tile cbc">
            Comic Book Crushers
            <!-- 
            <img src="../../cko 2023/assets/team logos/Retro Rumblers [Color] [Worn] [CKORD Cropped] [570px].png"
                alt="Retro Rumblers" height="100px">
            -->
        </div>
        <div id="away-team-score" class="tile score-tile away-score-tile">
            00
        </div>
    </div>

    <script type="text/javascript" src="../js/initialize_client.js">
        // Initialize the websocket connection
        // Transmit unique ID
    </script>

    <!-- WS604 clock timer connection -->
    <script type="text/javascript">
        const addr_cko = '192.168.1.200';
        const addr_ws = '192.168.4.1';
        // use instead of window.location.hostname

        window.onload=function(){ 
        let dis = "";
        // create a new WebSocket connection to clock's websocket server
        const Socket = new WebSocket('ws://' + addr_cko + ':81/');
        
        // a new message event occurs every time clock element is updated
        Socket.onmessage = function(event){
            // get original message
            dis = event.data;
            console.log(event.data);
            // update jam-timer element
            document.getElementById("jam-timer").innerHTML = dis;
        }
    }
  </script>
  <script type="text/javascript" src="../js/scoreboard_controls/shared_elements.js">
    // elements shared between scoreboard-scores.html and scoreboard-banner.html.  
    // the same IDs are used between both to associate the corresponding source 
    // and target elements
  </script>


  <script>
    // handle incoming messages from server
    ws.onmessage = (event) => {
        const data = JSON.parse(event.data);
        console.log(`Message received: ${data}`);
        console.log(`Message type: ${data.type}`);
        if (data.type === 'scoreUpdate') {
            // update both team scores
            homeTeamScore.textContent = data.content.home;
            awayTeamScore.textContent = data.content.away;
        } else if (data.type === 'homeTeamUpdate') {
            // update home team score only
            homeTeamScore.textContent = data.content.home;
        } else if (data.type === 'awayTeamUpdate') {
            // update away team score only
            awayTeamScore.textContent = data.content.away;
        } else if (data.type === 'jamNumber') {
            // update jam number
            jamNumber.textContent = data.content.jam;
        } else if (data.type === 'gameSegment') {
            // update game segment
            gameSegment.textContent = data.content.segment;
        } else if (data.type === 'error') {
            alert(data.message);
        } 
    };
  </script>

    <!--
  <script type="text/javascript" src="../js/target_clients/scoreboard-banner-client.js">
        // handle incoming score updates from server
        // this should update scores over websockets
  </script>

    <script type="text/javascript" src="../js/scoreboard_controls/update_home_team_score.js">
        // update home team score with local Storage
        // this will be replaced by eventListeners
    </script>

    <script type="text/javascript" src="../js/scoreboard_controls/update_away_team_score.js">
        // update away team score with local Storage
        // this will be replaced by eventListeners
    </script>



    <textarea id="messages" rows="10" cols="30" readonly></textarea><br>
    <input id="targetId" type="text" placeholder="Target Client ID"><br>
    <input id="messageInput" type="text" placeholder="Type a message">
    <button id="sendButton">Send</button>

    <script>
        // create new websocket connection
        const ws = new WebSocket('ws://localhost:3000');
        let clientId = null;

        ws.onopen = () => {
            console.log('Connected to WebSocket server');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'welcome') {
                clientId = data.clientId;
                console.log(`Assigned Client ID: ${clientId}`);
            } else if (data.type === 'message') {
                const messages = document.getElementById('messages');
                messages.value += `${data.content}\n`;
                homeTeamScore.textContent = data.content.home;
                awayTeamScore.textContent = data.content.away;
            } else if (data.type === 'error') {
                alert(data.message);
            }
        };

        ws.onclose = () => {
            console.log('Disconnected from WebSocket server');
        };
    </script>
    -->
</body>
</html>